# Bot Alfa

## Быстрый старт
1. Склонируйте репозиторий и установите зависимости:
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. Создайте файл `.env`, скопировав `.env.example`, и укажите токен бота (`BOT_TOKEN`). При желании добавьте `API_KEY` для защиты HTTP-эндпоинтов.
3. Запустите:
   ```bash
   python -m app.main
   ```
   Бот запустит Telegram-поллинг и HTTP-сервер на `API_HOST:API_PORT`.

## Основные команды бота
- `/start` — приветствие.
- `/submit` — отправка заявки (банк → комментарий → файл/скрин).
- `/my` — последние заявки отправителя.
- `/actions` — последние действия (доступно админам из `ADMIN_IDS`).
- `/help` — подсказка.

## HTTP-бэкенд
- `GET /health` — проверка статуса.
- `GET /submissions?limit=50` — последние заявки.
- `GET /actions?limit=50` — последние события.
- Если задан `API_KEY`, передавайте `X-API-Key` в заголовках запросов.

## Структура
- `app/config.py` — конфигурация из переменных окружения.
- `app/db.py` — хранение данных в SQLite (таблицы `submissions`, `actions`).
- `app/bot.py` — сценарии aiogram.
- `app/api.py` — FastAPI-приложение для просмотра данных.
- `app/main.py` — одновременный запуск бота и HTTP-сервера.
- `app/static/admin.html` — веб-админка; `app/static/login.html` — страница логина.

## Дальше
- Добавить статусы заявок и модерацию.
- Подтягивать файлы по `file_id` и отдавать в админке.
- Обвязать CI/линтингом и докером по необходимости.

## Веб-админка с логином/паролем
- Задайте в `.env`: `ADMIN_USER_ID` (Telegram ID как логин), `ADMIN_PASSWORD`, `ADMIN_SECRET` (любой длинный случайный, если пусто — возьмется `API_KEY`).
- Запуск как обычно (`python -m app.main`), затем заходите на `http://<host>:<port>/admin`.
- При первом заходе редирект на `/admin/login`. После ввода логина/пароля выставляется cookie-сессия, затем можно смотреть таблицы заявок/событий.
- Данные `/submissions` и `/actions` теперь требуют либо валидную cookie-сессию, либо `X-API-Key` (если настроен).
